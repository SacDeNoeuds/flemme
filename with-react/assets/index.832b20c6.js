var Z=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var P=(s,t,e)=>t in s?Z(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,L=(s,t)=>{for(var e in t||(t={}))O.call(t,e)&&P(s,e,t[e]);if(N)for(var e of N(t))R.call(t,e)&&P(s,e,t[e]);return s},z=(s,t)=>ee(s,te(t));var I=(s,t)=>{var e={};for(var i in s)O.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&N)for(var i of N(s))t.indexOf(i)<0&&R.call(s,i)&&(e[i]=s[i]);return e};var j=(s,t,e)=>(P(s,typeof t!="symbol"?t+"":t,e),e);import{r as M,g as se,s as re,f as ie,c as oe,o as ne,a as V,b as W,d as ae,j as T,R as ce,e as le}from"./vendor.6c79a762.js";const de=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=e(o);fetch(o.href,a)}};de();const B=(s,t)=>((e,i,o)=>{for(const a of e)i(a)&&o(a)})(s,t,e=>s.delete(e)),_=(s,t)=>{for(const e of s)if(t(e))return!0;return!1},ue=(s=[],t,e=s.length)=>[...s.slice(0,e),t,...s.slice(e)],he=(s,t)=>s==null?void 0:s.filter((e,i)=>i!==t),fe=({get:s,set:t,isEqual:e,cloneDeep:i})=>({initial:o,validate:a=()=>{},validationTriggers:l=[]})=>{let h=i(o),f=i(h);const m=new Set,u=new Map,v=new Set,x=new Set;let d,F,w=!1;const A={blur:[],change:[],focus:[],reset:[],validated:[]},k=new WeakMap,S=(r,n)=>A[r].forEach(p=>p(n)),b={initial:r=>r===void 0?h:s(h,r),value:r=>r===void 0?f:s(f,r),isDirty:r=>!e(b.value(r),b.initial(r)),isActive:r=>r?!!(d==null?void 0:d.startsWith(r)):!!d,isModified:r=>!!w||(r?_(m,n=>n.startsWith(r)):m.size>0),isVisited:r=>!!w||(r?_(v,n=>n.startsWith(r)):v.size>0),change:(...r)=>r.length===1?U(r[0]):G(r[0],r[1]),blur:r=>{d=void 0,S("blur",r)},focus:r=>{d=r,v.add(r),w&&x.add(r),S("focus",r)},reset:(r=h)=>{h=i(r),f=i(r),w=!1,m.clear(),v.clear(),F=void 0,d=void 0,S("reset",void 0)},resetAt:(...r)=>{const[n,p]=r;r.length===2&&t(h,n,p),t(f,n,s(h,n)),B(m,y=>y.startsWith(n)),B(v,y=>y.startsWith(n)),w=!1,(d==null?void 0:d.startsWith(n))&&(d=void 0),S("reset",n)},on:(r,n,p)=>p===void 0?H(r,n):Q(r,n,p),off:(r,n)=>X(r,n),submit:async r=>{if(w=!0,b.validate(),!b.isValid())throw new Error("invalid form data");return r(b.value()).then(()=>b.reset(b.value())).finally(()=>Y())},validate:()=>{F=a(f),S("validated",void 0)},errors:()=>F,isValid:()=>F===void 0},U=r=>{f=i(r),m.add(""),S("change",void 0)},G=(r,n)=>{t(f,r,n),m.add(r),w&&u.set(r,n),S("change",r)},H=(r,n)=>{const p=()=>n();k.set(n,p),A[r].push(p)},Q=(r,n,p)=>{const y=C=>{C&&!C.startsWith(r)||p()};k.set(p,y),A[n].push(y)},X=(r,n)=>{const p=k.get(n);A[r]=A[r].filter(y=>y!==p)},Y=()=>{x.forEach(r=>v.add(r)),x.clear(),u.forEach((r,n)=>b.change(n,r)),u.clear()};return l.forEach(r=>{b.on(r,()=>b.validate())}),b},pe={initial:["reset"],value:["change","reset"],isActive:["focus","blur"],isDirty:["change","reset"],isModified:["change","reset"],isVisited:["focus","reset"],errors:["validated"]},me=["reset","validated","change","blur","focus"];class J extends M.exports.Component{constructor(){super(...arguments);j(this,"watchers",this.props.watch?[...new Set(this.props.watch.flatMap(t=>pe[t]))]:me);j(this,"state",this.getFieldState());j(this,"setFieldState",()=>{this.setState(this.getFieldState())})}getFieldState(){const{form:t,path:e}=this.props;return{path:e,value:t.value(e),initial:t.initial(e),isDirty:t.isDirty(e),isModified:t.isModified(e),isVisited:t.isVisited(e),isActive:t.isActive(e),change:i=>t.change(e,i),blur:()=>t.blur(e),focus:()=>t.focus(e),reset:i=>t.resetAt(e,i)}}componentDidMount(){const{form:t,path:e}=this.props;this.watchers.forEach(i=>t.on(e,i,this.setFieldState))}componentWillUnmount(){const{form:t}=this.props;this.watchers.forEach(e=>t.off(e,this.setFieldState))}render(){return this.props.children(this.state)}}const D=(s,t)=>(e,i)=>{const o=e[s],[a,l]=M.exports.useState(o(i));return M.exports.useEffect(()=>{const h=()=>l(o(i));return t.forEach(f=>i?e.on(i,f,h):e.on(f,h)),()=>t.forEach(f=>e.off(f,h))},[i,o,e]),a},ge=D("isModified",["change","reset","validated"]),ve=D("isVisited",["focus","reset","validated"]),be=D("isDirty",["change","reset"]),ye=D("errors",["validated"]),we=D("value",["change","reset"]),Se=fe({get:se,set:re,isEqual:ie,cloneDeep:oe}),Ee=s=>new Promise(t=>setTimeout(t,s)),K=ne({username:V(W(),4,233),password:V(W(),4,233),confirmation:V(W(),4,233),requirements:ae(V(W(),6,20))}),xe={passwordMismatch:"passwordMismatch"},Fe=s=>{const[t]=K.validate(s);if(t)return t.failures().map(i=>{var o;return{code:(o=i.refinement)!=null?o:i.type,path:i.path.join("."),failure:i}});K.assert(s);const e=[];return s.password!==s.confirmation&&e.push({code:xe.passwordMismatch,path:"confirmation"}),e.length===0?void 0:e},Me=(s={})=>Se({initial:s,validate:Fe,validationTriggers:["change"]}),Ae=async s=>{await Ee(750),console.info("Submitted:",s)},c=T.exports.jsx,g=T.exports.jsxs;var E;(function(s){s.NotAsked="NotAsked",s.Pending="Pending",s.Failure="Failure",s.Success="Success"})(E||(E={}));const De=({initialValue:s,onRegister:t=Ae})=>{var f;const e=M.exports.useMemo(()=>Me(s),[s]),[i,o]=M.exports.useState(E.NotAsked),a=be(e),l=(f=ye(e))!=null?f:[];return g("form",{onSubmit:m=>{m.preventDefault(),e.submit(u=>(o(E.Pending),t(u).then(()=>o(E.Success)).catch(()=>o(E.Failure))))},className:"form",children:[g("label",{children:["Submission state: ",i,c("br",{}),"Form validity: ",l.length>0?"Invalid":"Valid"]}),g("label",{children:["Dirty: ",JSON.stringify(a)]}),i===E.Pending&&c("div",{className:"dimmer"}),g("label",{children:["Name",c(q,{form:e,path:"username"}),c($,{form:e,path:"username",errors:l})]}),g("label",{children:["Password",c(J,{form:e,path:"password",watch:["value"],children:({path:m,value:u,change:v,focus:x,blur:d})=>c("input",{"data-test":console.info({path:m,value:u}),type:"password",value:u!=null?u:"",onChange:F=>{v(F.target.value||void 0)},onFocus:x,onBlur:d})}),c($,{form:e,path:"password",errors:l})]}),g("label",{children:["Confirm password",c(q,{type:"password",form:e,path:"confirmation"}),c($,{form:e,path:"confirmation",errors:l})]}),c(J,{form:e,path:"requirements",children:({path:m,value:u,change:v})=>g("fieldset",{children:[g("legend",{children:["Requirements ",c("button",{type:"button",onClick:()=>v(ue(u,"")),children:"+"})]}),u==null?void 0:u.map((x,d)=>g("label",{children:[`#${d+1} `,g("div",{style:{display:"flex"},children:[c(q,{form:e,path:`${m}.${d}`}),"\xA0",c("button",{style:{flex:1},type:"button",onClick:()=>v(he(u,d)),children:"\xD7"})]}),c($,{form:e,path:`${m}.${d}`,errors:l})]},d))]})}),c("div",{style:{textAlign:"center"},children:c("button",{type:"submit",children:"Submit"})})]})},$=({form:s,path:t,errors:e})=>{const i=M.exports.useMemo(()=>e.filter(l=>l.path===t),[e,t]),o=ge(s,t),a=ve(s,t);return i.length===0||!o&&!a?null:g("small",{className:"feedback-error",children:["Errors: ",i.map(l=>`"${l.code}"`).join(", ")]})},q=o=>{var a=o,{type:s="text",form:t,path:e}=a,i=I(a,["type","form","path"]);const l=we(t,e);return c("input",z(L({},i),{type:s,value:l!=null?l:"",onChange:h=>{t.change(e,h.target.value||void 0),console.info("change",{path:e,value:h.target.value||void 0,form:t.value()})},onFocus:()=>t.focus(e),onBlur:()=>t.blur(e)}))};function Ne(){return g("div",{className:"app",children:[c("h2",{children:"Registration form"}),c("p",{children:"Open console to see submitted values \u{1F609}"}),c(De,{})]})}ce.render(c(le.StrictMode,{children:c(Ne,{})}),document.getElementById("root"));
