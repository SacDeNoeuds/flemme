var Z=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var B=(s,t,e)=>t in s?Z(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,L=(s,t)=>{for(var e in t||(t={}))C.call(t,e)&&B(s,e,t[e]);if(D)for(var e of D(t))O.call(t,e)&&B(s,e,t[e]);return s},z=(s,t)=>ee(s,te(t));var I=(s,t)=>{var e={};for(var i in s)C.call(s,i)&&t.indexOf(i)<0&&(e[i]=s[i]);if(s!=null&&D)for(var i of D(s))t.indexOf(i)<0&&O.call(s,i)&&(e[i]=s[i]);return e};var j=(s,t,e)=>(B(s,typeof t!="symbol"?t+"":t,e),e);import{r as M,g as se,s as re,f as ie,c as ne,o as oe,a as k,b as V,d as ae,e as ce,j as P,R as le,h as de}from"./vendor.f0163273.js";const ue=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerpolicy&&(c.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?c.credentials="include":n.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(n){if(n.ep)return;n.ep=!0;const c=e(n);fetch(n.href,c)}};ue();const T=(s,t)=>((e,i,n)=>{for(const c of e)i(c)&&n(c)})(s,t,e=>s.delete(e)),_=(s,t)=>{for(const e of s)if(t(e))return!0;return!1},he=(s=[],t,e=s.length)=>[...s.slice(0,e),t,...s.slice(e)],fe=(s,t)=>s==null?void 0:s.filter((e,i)=>i!==t),pe=({get:s,set:t,isEqual:e,cloneDeep:i})=>({initial:n,validate:c=()=>{},validationTriggers:l=[]})=>{let u=i(n),h=i(u);const g=new Set,f=new Map,v=new Set,x=new Set;let d,E,S=!1;const N={blur:[],change:[],focus:[],reset:[],validated:[]},$=new WeakMap,F=(r,o)=>N[r].forEach(p=>p(o)),b={initial:r=>r===void 0?u:s(u,r),value:r=>r===void 0?h:s(h,r),isDirty:r=>!e(b.value(r),b.initial(r)),isActive:r=>r?!!(d==null?void 0:d.startsWith(r)):!!d,isModified:r=>!!S||(r?_(g,o=>o.startsWith(r)):g.size>0),isVisited:r=>!!S||(r?_(v,o=>o.startsWith(r)):v.size>0),change:(...r)=>r.length===1?U(r[0]):G(r[0],r[1]),blur:r=>{d=void 0,F("blur",r)},focus:r=>{d=r,v.add(r),S&&x.add(r),F("focus",r)},reset:(r=u)=>{u=i(r),h=i(r),S=!1,g.clear(),v.clear(),E=void 0,d=void 0,F("reset",void 0)},resetAt:(...r)=>{const[o,p]=r;r.length===2&&t(u,o,p),t(h,o,s(u,o)),T(g,y=>y.startsWith(o)),T(v,y=>y.startsWith(o)),S=!1,(d==null?void 0:d.startsWith(o))&&(d=void 0),F("reset",o)},on:(r,o,p)=>p===void 0?H(r,o):Q(r,o,p),off:(r,o)=>X(r,o),submit:async r=>{if(S=!0,b.validate(),!b.isValid())throw new Error("invalid form data");return r(b.value()).then(()=>b.reset(b.value())).finally(()=>Y())},validate:()=>{E=c(h),F("validated",void 0)},errors:()=>E,isValid:()=>E===void 0},U=r=>{h=i(r),g.add(""),F("change",void 0)},G=(r,o)=>{t(h,r,o),g.add(r),S&&f.set(r,o),F("change",r)},H=(r,o)=>{const p=()=>o();$.set(o,p),N[r].push(p)},Q=(r,o,p)=>{const y=q=>{q&&!q.startsWith(r)||p()};$.set(p,y),N[o].push(y)},X=(r,o)=>{const p=$.get(o);N[r]=N[r].filter(y=>y!==p)},Y=()=>{x.forEach(r=>v.add(r)),x.clear(),f.forEach((r,o)=>b.change(o,r)),f.clear()};return l.forEach(r=>{b.on(r,()=>b.validate())}),b},me={initial:["reset"],value:["change","reset"],isActive:["focus","blur"],isDirty:["change","reset"],isModified:["change","reset"],isVisited:["focus","reset"],errors:["validated"]},ge=["reset","validated","change","blur","focus"];class J extends M.exports.Component{constructor(){super(...arguments);j(this,"watchers",this.props.watch?[...new Set(this.props.watch.flatMap(t=>me[t]))]:ge);j(this,"state",this.getFieldState());j(this,"setFieldState",()=>{this.setState(this.getFieldState())})}getFieldState(){const{form:t,path:e}=this.props;return{path:e,value:t.value(e),initial:t.initial(e),isDirty:t.isDirty(e),isModified:t.isModified(e),isVisited:t.isVisited(e),isActive:t.isActive(e),change:i=>t.change(e,i),blur:()=>t.blur(e),focus:()=>t.focus(e),reset:i=>t.resetAt(e,i)}}componentDidMount(){const{form:t,path:e}=this.props;this.watchers.forEach(i=>t.on(e,i,this.setFieldState))}componentWillUnmount(){const{form:t}=this.props;this.watchers.forEach(e=>t.off(e,this.setFieldState))}render(){return this.props.children(this.state)}}const A=(s,t)=>(e,i)=>{const n=e[s],[c,l]=M.exports.useState(n(i));return M.exports.useEffect(()=>{const u=()=>l(n(i));return t.forEach(h=>i?e.on(i,h,u):e.on(h,u)),()=>t.forEach(h=>e.off(h,u))},[i,n,e]),c},ve=A("isModified",["change","reset","validated"]),be=A("isVisited",["focus","reset","validated"]),ye=A("isDirty",["change","reset"]),we=A("errors",["validated"]),Se=A("value",["change","reset"]),Fe=pe({get:se,set:re,isEqual:ie,cloneDeep:ne}),xe=s=>new Promise(t=>setTimeout(t,s)),K=oe({username:k(V(),4,233),password:k(V(),4,233),confirmation:k(V(),4,233),requirements:ae(ce(k(V(),3,20)))}),Ee={passwordMismatch:"passwordMismatch"},Me=s=>{const[t]=K.validate(s);if(t)return t.failures().map(i=>{var n;return{code:(n=i.refinement)!=null?n:i.type,path:i.path.join("."),failure:i}});K.assert(s);const e=[];return s.password!==s.confirmation&&e.push({code:Ee.passwordMismatch,path:"confirmation"}),e.length===0?void 0:e},Ne=(s={})=>Fe({initial:s,validate:Me,validationTriggers:["change"]}),Ae=async s=>{await xe(750),console.info("Submitted:",s)},a=P.exports.jsx,m=P.exports.jsxs,De=P.exports.Fragment;var w;(function(s){s.NotAsked="NotAsked",s.Pending="Pending",s.Failure="Failure",s.Success="Success"})(w||(w={}));const je=({initialValue:s,onRegister:t=Ae})=>{var h;const e=M.exports.useMemo(()=>Ne(s),[s]),[i,n]=M.exports.useState(w.NotAsked),c=ye(e),l=(h=we(e))!=null?h:[];return m(De,{children:[m("form",{onSubmit:g=>{g.preventDefault(),console.info("form errors",l),e.submit(f=>(n(w.Pending),t(f).then(()=>n(w.Success)).catch(()=>n(w.Failure))))},className:"form",children:[m("label",{children:["Submission state: ",i,a("br",{}),"Form validity: ",l.length>0?"Invalid":"Valid"]}),m("label",{children:["Dirty: ",JSON.stringify(c)]}),i===w.Pending&&a("div",{className:"dimmer"}),m("label",{children:["Name",a(R,{form:e,path:"username"}),a("small",{className:"feedback-info",children:"Between 4 and 233 characters"}),a(W,{form:e,path:"username",errors:l})]}),m("label",{children:["Password",a(J,{form:e,path:"password",watch:["value"],children:({path:g,value:f,change:v,focus:x,blur:d})=>a("input",{type:"password",name:g,value:f!=null?f:"",onChange:E=>{v(E.target.value||void 0)},onFocus:x,onBlur:d})}),a("small",{className:"feedback-info",children:"Between 4 and 233 characters"}),a(W,{form:e,path:"password",errors:l})]}),m("label",{children:["Confirm password",a(R,{type:"password",form:e,path:"confirmation"}),a("small",{className:"feedback-info",children:"Between 4 and 233 characters"}),a(W,{form:e,path:"confirmation",errors:l})]}),a(J,{form:e,path:"requirements",children:({path:g,value:f,change:v})=>m("fieldset",{children:[m("legend",{children:["Requirements ",a("button",{type:"button",onClick:()=>v(he(f,"")),children:"+"})]}),f==null?void 0:f.map((x,d)=>m("label",{children:[`#${d+1} `,m("div",{style:{display:"flex"},children:[a(R,{form:e,path:`${g}.${d}`}),"\xA0",a("button",{style:{flex:1},type:"button",onClick:()=>v(fe(f,d)),children:"\xD7"})]}),a("small",{className:"feedback-info",children:"Between 3 and 20 characters"}),a(W,{form:e,path:`${g}.${d}`,errors:l})]},d))]})}),a("div",{style:{textAlign:"center"},children:a("button",{type:"submit",children:"Submit"})})]}),a("h4",{children:"Last successful submitted result:"}),a("pre",{children:a("code",{children:i===w.Success&&JSON.stringify(e.value(),null,2)})})]})},W=({form:s,path:t,errors:e})=>{const i=M.exports.useMemo(()=>e.filter(l=>l.path===t),[e,t]),n=ve(s,t),c=be(s,t);return i.length===0||!n&&!c?null:m("small",{className:"feedback-error",children:["Errors: ",i.map(l=>`"${l.code}"`).join(", ")]})},R=n=>{var c=n,{type:s="text",form:t,path:e}=c,i=I(c,["type","form","path"]);const l=Se(t,e);return a("input",z(L({},i),{type:s,value:l!=null?l:"",onChange:u=>{t.change(e,u.target.value||void 0),console.info("change",{path:e,value:u.target.value||void 0,form:t.value()})},onFocus:()=>t.focus(e),onBlur:()=>t.blur(e)}))};function ke(){return m("div",{className:"app",children:[a("h2",{children:"Registration form"}),m("p",{children:["Build with ",a("a",{href:"https://reactjs.org/",children:"React"})," and ",a("a",{href:"https://docs.superstructjs.org/",children:"superstruct"})," \u{1F609}"]}),a(je,{})]})}le.render(a(de.StrictMode,{children:a(ke,{})}),document.getElementById("root"));
